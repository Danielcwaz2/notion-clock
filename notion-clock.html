<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Notion Clock</title>
<style>
  :root{
    --fg:#111111;         /* text color */
    --bg:transparent;     /* background */
    --accent:#6b8afd;     /* accent for date dots */
    --font: ui-sans-serif, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    --weight: 700;        /* 400..900 */
    --radius: 16px;       /* px */
    --pad: 20px;          /* px */
    --size: 64px;         /* main clock font-size */
    --date-size: 14px;    /* date line font-size */
    --letter: 0.02em;     /* letter-spacing */
    --shadow: 0 2px 18px rgba(17,17,17,.06);
  }
  html,body{height:100%}
  body{
    margin:0;
    display:grid;
    place-items:center;
    background:var(--bg);
    color:var(--fg);
    font-family:var(--font);
  }
  .card{
    padding:var(--pad);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    background:var(--bg);
  }
  .time{
    display:flex; gap:.25ch; align-items:baseline; justify-content:center;
    font-weight:var(--weight);
    font-size:var(--size);
    letter-spacing:var(--letter);
    line-height:1.05;
    white-space:nowrap;
  }
  .ampm{font-size:calc(var(--size)*.35); font-weight:600; opacity:.75; margin-left:.25ch}
  .date{
    margin-top:.4rem;
    text-align:center;
    font-size:var(--date-size);
    opacity:.85;
  }
  .dots{
    color:var(--accent);
    padding:0 .25ch;
    user-select:none;
  }
  .tz{
    margin-top:.25rem;
    text-align:center;
    font-size:12px;
    opacity:.65;
  }

  /* Responsive scaling inside iframes */
  @media (max-width:400px){ :root{ --size: 48px; --pad:16px; } }
  @media (max-width:300px){ :root{ --size: 40px; --pad:12px; } }

  /* Optional: auto dark if background not overridden */
  @media (prefers-color-scheme: dark){
    :root{ --fg:#f5f5f5; --shadow:none; }
  }
</style>
</head>
<body>
  <div class="card" id="wrap">
    <div class="time" id="time">
      <span id="hh">--</span><span>:</span><span id="mm">--</span><span id="secwrap" style="display:none"><span>:</span><span id="ss">--</span></span><span class="ampm" id="ampm" style="display:none">AM</span>
    </div>
    <div class="date" id="date">—</div>
    <div class="tz" id="tzline"></div>
  </div>

<script>
/* --------- URL PARAMS ----------
   tz       : IANA zone (e.g. America/New_York, Europe/Paris)
   h24      : 1 for 24h mode (default 0 = 12h)
   seconds  : 1 to show seconds (default 0)
   size     : CSS size for clock (e.g. 60px, 8vw)
   fg/bg/accent : hex/rgb color (e.g. #111, rgba(0,0,0,.8))
   weight   : 400..900
   dateSize : CSS size for date text
   radius   : e.g. 16px
   pad      : e.g. 20px
   letter   : letter-spacing (e.g. 0.02em)
   showTZ   : 1 to display timezone line
----------------------------------*/
const q = new URLSearchParams(location.search);
const by = id => document.getElementById(id);

// Apply theme variables
const root = document.documentElement;
const setVar = (k, v) => v && root.style.setProperty(k, v);
setVar('--fg', q.get('fg'));
setVar('--bg', q.get('bg'));
setVar('--accent', q.get('accent'));
setVar('--size', q.get('size'));
setVar('--date-size', q.get('dateSize'));
setVar('--weight', q.get('weight'));
setVar('--radius', q.get('radius'));
setVar('--pad', q.get('pad'));
setVar('--letter', q.get('letter'));

const tz = q.get('tz') || Intl.DateTimeFormat().resolvedOptions().timeZone;
const h24 = q.get('h24') === '1';
const showSeconds = q.get('seconds') === '1';
const showTZ = q.get('showTZ') === '1';

if (showSeconds) by('secwrap').style.display = '';
if (!h24) by('ampm').style.display = '';

function pad(n){ return String(n).padStart(2,'0'); }

function render(){
  try{
    const now = new Date();
    const fmt = new Intl.DateTimeFormat('en-US', {
      timeZone: tz, hour12: !h24, hour: 'numeric', minute:'2-digit', second: showSeconds ? '2-digit' : undefined
    });
    // Because Intl gives a formatted string, we’ll construct parts for flexibility:
    const parts = new Intl.DateTimeFormat('en-US', {
      timeZone: tz, hour12: !h24,
      hour: 'numeric', minute:'numeric', second: showSeconds ? 'numeric' : undefined
    }).formatToParts(now).reduce((acc,p)=> (acc[p.type]=p.value, acc), {});

    let h = parts.hour || '--';
    let m = parts.minute || '--';
    let s = parts.second || '--';
    let ampm = parts.dayPeriod || '';

    // Normalize to two-digits for display
    if (h24) h = pad(h);
    m = pad(m);
    if (showSeconds) s = pad(s);

    by('hh').textContent = h;
    by('mm').textContent = m;
    if (showSeconds) by('ss').textContent = s;
    if (!h24) by('ampm').textContent = ampm?.toUpperCase() || '';

    // Date line: Tue • Oct 7, 2025
    const dParts = new Intl.DateTimeFormat('en-US', {
      timeZone: tz, weekday:'short', month:'short', day:'numeric', year:'numeric'
    }).formatToParts(now).reduce((acc,p)=> (acc[p.type]=p.value, acc), {});
    by('date').innerHTML = `${dParts.weekday || ''}<span class="dots"> • </span>${dParts.month || ''} ${dParts.day || ''}, ${dParts.year || ''}`;

    by('tzline').textContent = showTZ ? tz : '';
  }catch(e){
    by('date').textContent = 'Invalid time zone';
  }
}
render();
setInterval(render, 250); // smooth seconds

// Optional: auto-fit height for tight Notion embeds
function autosize(){
  const h = document.getElementById('wrap').getBoundingClientRect().height;
  if (window.parent) {
    // No postMessage protocol in Notion; this is a harmless noop safeguard
  }
}
</script>
</body>
</html>
